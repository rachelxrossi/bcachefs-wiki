<div class="toc">
  {{ $toc := .TableOfContents }}
  {{ if (in $toc "<li>") }}
    <h3>On this page</h3>
    {{ $toc }}
  {{ end }}
  </div>

{{/* In this section: show only on child pages (not on section landing), and only for real sections */}}
{{ if and .CurrentSection (not .IsSection) (ne .Section "") }}
  {{ if eq .Section "news" }}
    <div class="sectionlist up-link">
      {{ with .CurrentSection }}
        <a class="up-link" href="{{ .RelPermalink }}">← {{ .Title }}</a>
      {{ end }}
    </div>
  {{ else }}
    <div class="sectionlist">
      {{ with .CurrentSection }}
        {{ $cur := . }}
        <h3>In this section</h3>
        <ul>
          <li><a href="{{ $cur.RelPermalink }}">← {{ $cur.Title }}</a></li>
          {{ range sort (where .RegularPages "Draft" "ne" true) "Title" }}
            <li>
              <a href="{{ .RelPermalink }}">{{ .Title }}</a>
              {{ if eq .RelPermalink $cur.RelPermalink }}
              {{ end }}
            </li>
          {{ end }}
        </ul>
      {{ end }}
    </div>
  {{ end }}
{{ end }}

{{/* See Also: configurable per page; falls back to section-level */}}
{{ $see := .Params.see_also }}
{{ if not $see }}
  {{ with .CurrentSection }}
    {{ $see = .Params.see_also }}
  {{ end }}
{{ end }}
{{ with $see }}
  <div class="seealso">
    <h3>See also</h3>
    <ul>
      {{ range . }}
        {{/* Support objects: {title, ref|url}, or bare strings treated as ref */}}
        {{ $item := . }}
        {{ with $item.ref }}
          {{ $href := relref $ . }}
          {{ $title := (or $item.title (path.Base .)) }}
          <li><a href='{{ $href }}'>{{ $title }}</a></li>
        {{ else }}
          {{ with $item.url }}
            {{ $title := (or $item.title .) }}
            <li><a href='{{ . }}' rel='noopener'>{{ $title }}</a></li>
          {{ else }}
            <li><a href='{{ relref $ $item }}'>{{ $item }}</a></li>
          {{ end }}
        {{ end }}
      {{ end }}
    </ul>
  </div>
{{ end }}
